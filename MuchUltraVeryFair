repeat wait() until game:IsLoaded()
getgenv().Get = setmetatable({}, {__index = function(Self, Idx) return game:GetService(Idx) end})
getgenv().ToggleFarm = false
getgenv().ToggleKillAura = false
getgenv().ToggleMobAura = false

getgenv().AuraDistance = 6
getgenv().FarmDistance = 3
getgenv().KillPlayers = true
getgenv().KillDistance = 12

getgenv().PunchSpeed = 0.15
getgenv().SelectedQuest = nil
getgenv().RollAmount = 25

getgenv().AuraMode = false

getgenv().FarmBoss = false

getgenv().ToggleAutoRoll = false
getgenv().RollThreshold = 15



local Players = Get.Players
local Player = Players.LocalPlayer


local Workspace = Get.Workspace

local RunService = Get.RunService
local Rep = game:GetService("ReplicatedStorage")



local VirtualUser=game:service'VirtualUser'
game:service'Players'.LocalPlayer.Idled:connect(function()
VirtualUser:CaptureController()
VirtualUser:ClickButton2(Vector2.new())
end)

--Hide Name
function HideName()
    for i,v in pairs(game.Players.LocalPlayer.Character:GetDescendants()) do
        if v.ClassName == "BillboardGui" then
            v:Destroy()
        end
    end
end




RunService.Stepped:Connect(
   function()
       if ToggleFarm then
           for i, v in pairs(Player.Character:GetChildren()) do
               if v:IsA("BasePart") then
                   v.CanCollide = false
               end
           end
       end
   end
)


local Old = getsenv(Player.PlayerScripts.MoveHandler)
-- Improved Fps Due to these functions fucking up the game go figures
hookfunction(
Old.camshake,
function()
    return
end
)
hookfunction(
Old._G.knockback,
function()
    return
end
)
hookfunction(
Old._G.HitEffect,
function()
    return
end
)
hookfunction(
Old._G.flasheffect,
function()
    return
end
)
hookfunction(
Old.addparticle,
function()
    return
end
)



local function ActivateAbility()
    local args = {[1] = false} 
    Rep.ToggleAbility:InvokeServer(unpack(args))
end


A = require(Workspace.EnemyStats) --Get enemy names and stats
local MobList = {}
for i, v in pairs(A) do
    table.insert(MobList, i) --append name to list
end


local function getNearestMobs(Type)
    local LowestDistance = math.huge
    local Target
    for i, v in ipairs(Workspace:GetChildren()) do
        if v:IsA("Model")  then
            if ToggleFarm then
                if not(table.find(Type, v.Name)) then
                    continue
                end
            elseif ToggleMobAura then
                if not(table.find(MobList, v.Name)) then
                    continue
                end
            elseif ToggleKillAura then
                if not(v:FindFirstChildWhichIsA("Humanoid")) or v.Name == Player.Name then
                    continue
                end
            end
            
            local Enemy = v:FindFirstChildWhichIsA("Humanoid")
            if Enemy and Enemy.Health ~= 0 then
                local CurrentDistance = (Player.Character.HumanoidRootPart.Position - v:GetModelCFrame().Position).Magnitude
                if CurrentDistance < LowestDistance then
                    LowestDistance = CurrentDistance
                    Target = v
                end
            end
        end
    end
    return Target
end

local function getNearestObstacles()
    local LowestDistance = math.huge
    local Target
    for i, v in ipairs(Workspace:GetChildren()) do
        if v:IsA("Model") and (not(table.find(MobList, v.Name)) or v.Name == "Barrier") and v.Name ~= Player.Name then
            local Enemy = v:FindFirstChildWhichIsA("Humanoid")
            if Enemy and Enemy.Health ~= 0 then
                local CurrentDistance = (Player.Character.HumanoidRootPart.Position - v:GetModelCFrame().Position).Magnitude
                if CurrentDistance < LowestDistance then
                    LowestDistance = CurrentDistance
                    Target = v
                end
            end
        end
    end
    return Target
end



local function Punch(Enemy)
    if Enemy.Name == "Barrier" then
            Rep.Punch:FireServer(Enemy:FindFirstChildWhichIsA("Humanoid"), 6, Player.Character.Cancellations.Value, nil, 2)
            if (PunchSpeed >= 0.15) then
                wait(PunchSpeed)
            else
                wait(0.15)
            end
    else
        for i = 1, 5 do
            Rep.Punch:FireServer(Enemy:FindFirstChildWhichIsA("Humanoid"), i, Player.Character.Cancellations.Value, nil, 3)
            if (PunchSpeed >= 0.15) then
                wait(PunchSpeed)
            else
                wait(0.15)
            end
        end
    end
end

local function ArbiterHit(Enemy)
    local args = {
        [1] = "Dark Blade",
        [2] = Enemy:FindFirstChildWhichIsA("Humanoid")
    }
    Rep.Damage:FireServer(unpack(args))
end

local function ArbiterUlt(Enemy)
    local args = {
        [1] = "Dark Blade",
        [2] = Enemy:FindFirstChildWhichIsA("Humanoid"),
        [4] = {["Ultimate"] = true}
    }
    Rep.Damage:FireServer(unpack(args))
end

local function EnergyBlade(Enemy)
    local args = {
        [1] = "DualSwordHeavy",
        [2] = Enemy:FindFirstChildWhichIsA("Humanoid"),
        [3] = Player.Character.Cancellations.Value,
        [4] = {
            [1] = Enemy:FindFirstChildWhichIsA("Humanoid")
        }
    }
    Rep.Damage:FireServer(unpack(args))
end



local function Hit(Enemy)
    if AuraMode == "Punch (Lowest 150ms)" then
        Punch(Enemy)
    elseif AuraMode == "Dark Blade (Arbiter Only)" then
        ArbiterHit(Enemy)
        wait(PunchSpeed)
    elseif AuraMode == "Energy Blade" then
        EnergyBlade(Enemy)
        wait(PunchSpeed)
    end
end


local function Quest(Quest)
    local args = {
        [1] = Quest
    } 
    Rep.TakeQuest:FireServer(unpack(args))
end


local function GetQuestMobs(quest)
    if quest == "Real Amgogus" then 
        EnemyType = {"Cripple"}
    elseif quest == "Gaming Disorder" then 
        EnemyType = {"Crail"}
    elseif quest == "Kingdom" then 
        EnemyType = {"Blyke", "Isen", "Remi", "Zeke"}
    elseif quest == "Rigged Game" then 
        EnemyType = {"Arlo", "John", "Seraphina"}
    elseif quest == "Trouble in the backrooms" then 
        EnemyType = {"Seer", "John", "Seraphina"}
    end
    return(EnemyType)
end



local function GetOffsetVector(Enemy)
    local Vector = Player.Character.HumanoidRootPart.Position - Enemy:GetModelCFrame().Position
    local Distance = (Vector).Magnitude
    local Normal = Vector3.new(Vector.x/Distance, Vector.y/Distance, Vector.z/Distance)
    local Offset = Normal * FarmDistance
    local NewPosition = Enemy:GetModelCFrame().Position + Offset
    return NewPosition
end

local BossFight = false
local EnemyBarrier = false

local function Farm()
    spawn(function()
        while wait() do
            if not BossFight then
                if ToggleFarm then
                    
                    pcall(function()
                    
                        if not Player.PlayerGui.MainClient.Quest.visible then
                            Quest(SelectedQuest)
                        else
                            local QuestCount = Player.PlayerGui.MainClient.Quest.Folder.Objective.progress.text:split("/")
                            if QuestCount[1] == QuestCount[2] then
                                Quest("Completed")
                            end
                        end
            

                        if not Player.Character:FindFirstChild("Head"):FindFirstChild("LeftGlow") then
                            ActivateAbility()
                        end

                        local EnemyType = GetQuestMobs(SelectedQuest)
                        local Enemy = getNearestMobs(EnemyType)
                        local CurrentDistance = (Player.Character.HumanoidRootPart.Position - Enemy:GetModelCFrame().Position).Magnitude

                        local Obstacle
                        Obstacle = getNearestObstacles()
                        if Obstacle.Name ~= "Barrier" and not ((Player.Character.HumanoidRootPart.Position - Obstacle:GetModelCFrame().Position).Magnitude <= KillDistance) then
                            EnemyBarrier = false
                        end
                        if CurrentDistance < AuraDistance and not(EnemyBarrier) then
                            local Hp1 = Enemy:FindFirstChildWhichIsA("Humanoid").Health
                            Hit(Enemy)
                            if (Hp1 - Enemy:FindFirstChildWhichIsA("Humanoid").Health) == 0 then
                                EnemyBarrier = true
                            end
                        elseif KillPlayers and CurrentDistance < KillDistance then
                            Hit(Obstacle)
                        elseif Obstacle.Name == "Barrier" and CurrentDistance <= AuraDistance then
                            Hit(Obstacle)
                        else
                            Player.Character.Humanoid:MoveTo(GetOffsetVector(Enemy))
                        end
                    end
                    )
                elseif (ToggleKillAura or ToggleMobAura) and not ToggleFarm then
                    pcall(function()
                        local Enemy = getNearestMobs()
                        if (Player.Character.HumanoidRootPart.Position - Enemy:GetModelCFrame().Position).Magnitude <= KillDistance then
                            Hit(Enemy)
                        end
                    end)
                end
            end
        end
    end)
end



B = Workspace:FindFirstChild("BossSpawns") --Get enemy names and stats
local BossList = {}
local BossPosition = B:GetChildren()[1].CFrame.Position
for i, v in B:GetChildren() do
    table.insert(BossList, v.Name) --append name to list
end

local function LocateBoss()
    for i, v in ipairs(Workspace:GetChildren()) do
        if v:IsA("Model") and table.find(BossList , v.Name) then
            if (v:GetModelCFrame().Position - BossPosition).Magnitude < 30 then
                return v
            end
        end
    end    
end


local function BossFarm()
    spawn(function()
        while wait() and FarmBoss do
            pcall(function()
                if Player.PlayerGui.Boss.Enabled == true then
                    local Boss = LocateBoss()
                    for i,v in pairs(getconnections(Player.PlayerGui.Reroll.bosstp.Yes.MouseButton1Click)) do
                        v.Function()
                    end
                    
                    while Boss.Humanoid.Health ~= 0 and FarmBoss do
                        if not Player.Character:FindFirstChild("Head"):FindFirstChild("LeftGlow") then
                            ActivateAbility()
                        end
                        BossFight = true
                        if (Player.Character.HumanoidRootPart.Position - Boss:GetModelCFrame().Position).Magnitude  < KillDistance then
                            Hit(Boss)
                        else
                            Player.Character.Humanoid:MoveTo(Boss:GetModelCFrame().Position)
                        end
                        wait(0.1)
                    end
                    BossFight = false
                    
                end
            end)
        end
    end)
end

local RerollPath = Player.PlayerGui.Reroll
local AbilityList = {}
getgenv().AbilityDict = {}
for i, v in pairs(RerollPath.Prompt.Prompt.ScrollingFrame:GetChildren()) do
    if v:IsA("TextButton") then
        table.insert(AbilityList, v.Name)
        AbilityDict[v.Name] = 0
    end
end

local function ConvertFloat(stri)
    local number = stri:split(".")
    local decimal = tonumber(number[2])/10
    local float = number[1] + decimal
    return (float)
end


local function AutoRoll()
    spawn(function()
        while wait() and ToggleAutoRoll do
            print("rolling")

            Rep.Reroll:InvokeServer()

            local Rolled

            repeat
                Rolled = RerollPath.Rerolling.Ability.TextLabel.Text
                wait()
            until RerollPath.Question.Visible == true

            local Level = Rolled:split("(")[2]:split(")")[1]
            local Ability = string.gsub(Rolled:split("(")[1], "%s+$", "")

            print("Rolled ".. Ability.. " " .. Level .. " | out of minimum | ".. AbilityDict[Ability])
            Level = ConvertFloat(Level)
            

            if (Level >= RollThreshold) or (Level>= AbilityDict[Ability] and AbilityDict[Ability] ~= 0) then
                print("Found Ability")
                break
            else
                while RerollPath.Question.Visible == true do
                    for i,v in pairs(getconnections(RerollPath.Question.no.MouseButton1Click)) do
                        v.Function()
                    end
                    wait(0.2)
                end
            end
            repeat 
                wait()
            until RerollPath.Rerolling.Visible == false
        end
    end)
end


Farm()



local UILibrary = loadstring(game:HttpGet("https://pastebin.com/raw/V1ca2q9s"))()

local MainUI = UILibrary.Load("Much Ultra, Very Fair")

local PageFarm = MainUI.AddPage("Farm", false)
    
local FarmToggle = PageFarm.AddToggle("Auto Farm (Set Aura Hit Mode)", false, function(value)
    ToggleFarm = value
end)

local SliderFarmDistance = PageFarm.AddSlider("Farm Distance", {Min = 0, Max = 15, Def = 3}, function(value)
    FarmDistance = value
end)

local SliderAuraDistance = PageFarm.AddSlider("Farm Aura Distance", {Min = 0, Max = 20, Def = 6}, function(value)
    AuraDistance = value
end)

local KillToggle = PageFarm.AddToggle("Kill Players while Farming (Uses Kill Aura Distance)", true, function(value)
    KillPlayers = value
end)

local BossToggle = PageFarm.AddToggle("Auto Boss Kill", false, function(value)
    FarmBoss = value
    if value then
        BossFarm()
    end
end)

local QuestSelect = PageFarm.AddDropdown("Quest Select", {
    "Real Amgogus",
    "Gaming Disorder",
    "Kingdom",
    "Rigged Game",
    "Trouble in the backrooms"
    }, function(value)
        SelectedQuest = value
end)



local PageKillAura = MainUI.AddPage("Kill Aura", false)

local KillAuraToggle = PageKillAura.AddToggle("Kill Aura", false, function(value)
    ToggleKillAura = value

end)

local MobAuraToggle = PageKillAura.AddToggle("Only Mob Kill Aura (Overrides Kill Aura)", false, function(value)
    ToggleMobAura = value
end)

local SliderKillDistance = PageKillAura.AddSlider("Kill Aura Distance", {Min = 0, Max = 16, Def = 12}, function(value)
    KillDistance = value
end)

local SliderPunchSpeed = PageKillAura.AddSlider("Hit Speed (ms)", {Min = 15, Max = 3000, Def = 150}, function(value)
    PunchSpeed = value/1000
end)

-- local Label1 = PageKillAura.AddLabel("Choose Aura Mode")

local AuraMode = PageKillAura.AddDropdown("Aura Hit Mode",
    {   
    "Punch (Lowest 150ms)",
    "Dark Blade (Arbiter Only)",
    "Energy Blade"
    }, function(value)
        AuraMode = value
end)



local PageRoll = MainUI.AddPage("Roll", false)

local RollAbility = PageRoll.AddButton("Roll Ability", function()
    Rep.Reroll:InvokeServer()
end)

local ToggleAutoRoll = PageRoll.AddToggle("Auto Roll Ability", false, function(value)
    ToggleAutoRoll = value
    if value then
        AutoRoll()
    end
end)

local RollThreshold = PageRoll.AddSlider("Roll Minimum Level (Global)", {Min = 0, Max = 20, Def = 15}, function(value)
    RollThreshold = value
end)

local LabelRoll = PageRoll.AddLabel("Equipment Roll")

local RollFist = PageRoll.AddButton("Roll Fist", function()
    for i = 1, RollAmount do
        local args = {
            [1] = "Fist"
        }

        game:GetService("ReplicatedStorage").RollGear:InvokeServer(unpack(args))
    end
end)

local RollStyle = PageRoll.AddButton("Roll Style", function()
    for i = 1, RollAmount do
        local args = {
            [1] = "Relic"
        }

        game:GetService("ReplicatedStorage").RollGear:InvokeServer(unpack(args))
    end
end)

local SliderGear = PageRoll.AddSlider("Equipment Roll Amount", {Min = 0, Max = 100, Def = 25}, function(value)
    RollAmount = value
end)



local PageAutoRoll = MainUI.AddPage("Auto Config", true)

local Button1 = PageAutoRoll.AddButton("Set Minimum Levels (Overrides Global, 0 is OFF)", function()
    for i, v in pairs(AbilityDict) do
        print("key: "..i.. " value: ".. v)
    end
end)

local AbilitySliders = {}

for i, v in pairs(AbilityList) do
    table.insert(AbilitySliders, (PageAutoRoll.AddSlider(v, {Min = 0, Max = 20, Def = 0}, function(value)
        AbilityDict[v] = value
    end)))
end



local PageMisc = MainUI.AddPage("Misc", false)

local HideName = PageMisc.AddButton("Hide Identity (Continuous)", function()
    HideName()
    Player.CharacterAdded:Connect(
        HideName()
    )
end)

local Reset = PageMisc.AddButton("Reset Character", function()
    Player.Character.Humanoid.Health = 0
end)

